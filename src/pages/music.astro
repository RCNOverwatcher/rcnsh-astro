---
import Layout from "@layouts/Layout.astro";
import Footer from "@components/Footer";
import Credits from "@components/Credits.astro";
import MobileDrawer from "@components/Drawer";
import { MusicIcon } from "astro-feather";

const response = await fetch("https://rcn.sh/api/spotify").then((res) =>
  res.json(),
);
const artists = response.artists as Artist[];
const tracks = response.tracks as Track[];

export type Track = {
  artists: { name: string }[];
  songUrl: string;
  title: string;
  album: string;
  image: string;
};
export type Artist = {
  name: string;
  url: string;
  image: string;
};
---

<Layout title="rcn.sh | Music">
  <main
    class="text-[#c5c0b8] h-[100dvh] min-h-[100dvh] w-[100dvw] overflow-x-hidden py-8 flex flex-col"
    transition:animate="fade"
  >
    <header
      class="sticky inset-x-0 top-0 z-10 mx-auto flex h-12 w-full shrink-0 items-center overflow-hidden text-sm font-medium lg:hidden"
    >
      <div class="flex h-full w-full items-center px-3">
        <div class="flex w-full items-center justify-between gap-2">
          <div class="flex flex-1 items-center gap-1">
            <MobileDrawer client:only />
          </div>
        </div>
      </div>
    </header>
    <svg
      class="w-[40%] md:w-[30%] lg:w-[25%] xl:w-[15%] mx-auto justify-center flex-shrink-0"
      xmlns="http://www.w3.org/2000/svg"
      id="Layer_1"
      data-name="Layer 1"
      viewBox="100 350 900 450"
      ><defs
        ><style>
          .cls-1 {
            fill: #305b99;
            strokewidth: 0;
          }
          .cls-2 {
            fill: #5b66af;
          }
        </style></defs
      ><g
        ><polygon
          points="947.67 500.78 902.38 579.22 857.08 657.67 766.48 657.67 811.77 579.22 857.07 500.78 766.48 500.78 721.19 579.22 675.88 657.67 585.3 657.67 630.59 579.22 539.99 579.22 585.28 500.78 675.88 500.78 675.88 500.76 721.17 422.31 902.38 422.31 902.38 422.33 947.67 500.78"
          class="cls-2"></polygon><polygon
          points="494.7 500.78 449.41 579.22 494.7 657.67 494.7 657.69 404.1 657.69 404.1 657.67 358.81 579.22 404.1 500.78 313.52 500.78 268.23 579.22 222.92 657.69 132.33 657.69 177.62 579.24 177.64 579.22 222.93 500.78 268.23 422.33 268.23 422.31 539.99 422.31 494.7 500.78"
          class="cls-1"></polygon></g
      ></svg
    >
    <section class="flex justify-center flex-col mx-2">
      <div class="flex justify-evenly font-mono text-3xl mt-4">
        <span>My Favourite Music</span>
        <div></div>
        <span>My Favourite Artists</span>
      </div>
      <div class="flex flex-row mt-8">
        <div
          class="max-w-4xl mx-auto grid auto-rows-[18rem] grid-cols-4 gap-4 mx-auto"
        >
          {
            tracks.map((item, i) => (
              <a
                class={
                  "row-span-1 rounded-xl hover:shadow-xl transition duration-200 shadow-input dark:shadow-none p-4 dark:bg-black dark:border-white/[0.2] bg-white border border-transparent justify-between flex flex-col space-y-4 hover:translate-x-2"
                }
                href={item.songUrl}
                target="_blank"
                rel="noopener noreferrer"
              >
                <div
                  class="h-full w-full bg-cover bg-center rounded-lg"
                  style={{ backgroundImage: `url(${item.image})` }}
                />
                <div class="bg-gradient-to-br from-neutral-900 to-neutral-700 p-3 rounded-lg mt-auto">
                  <MusicIcon width={16} height={16}/>
                  <div class="font-sans font-bold text-neutral-600 dark:text-neutral-200 mb-2 mt-2">
                    {item.title}
                  </div>
                  <div class="font-sans font-normal text-neutral-600 text-xs dark:text-neutral-300">
                    {item.artists.map((artist) => artist.name).join(", ")}
                  </div>
                </div>
              </a>
            ))
          }
        </div>
        <div
          class="max-w-4xl mx-auto grid auto-rows-[18rem] grid-cols-4 gap-4 mx-auto"
        >
          {
            artists.map((item, i) => (
              <a
                class={
                  "row-span-1 rounded-xl hover:shadow-xl transition duration-200 shadow-input dark:shadow-none p-4 dark:bg-black dark:border-white/[0.2] bg-white border border-transparent justify-between flex flex-col space-y-4 hover:translate-x-2"
                }
                href={item.url}
                target="_blank"
                rel="noopener noreferrer"
              >
                <div
                  class="h-full w-full bg-cover bg-center rounded-lg"
                  style={{ backgroundImage: `url(${item.image})` }}
                />
                <div class="bg-gradient-to-br from-neutral-900 to-neutral-700 p-3 rounded-lg mt-auto">
                  <MusicIcon width={16} height={16}/>
                  <div class="font-sans font-bold text-neutral-600 dark:text-neutral-200 mb-2 mt-2">
                    {item.name}
                  </div>
                </div>
              </a>
            ))
          }
        </div>
      </div>
    </section>
    <div class="mt-auto">
      <Footer client:only transition:persist>
        <Credits />
      </Footer>
    </div>
  </main>
</Layout>
